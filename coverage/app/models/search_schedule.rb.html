<html>
  <head>
    <title>app/models/search_schedule.rb</title>
    
    <link href="../../report.css?0.1428738266629035" media="screen" rel="stylesheet" type="text/css" />
    <script src='../../jquery.js?0.41939552188751184'></script>
    <script>
      $(function() {

        $('#toggle_test_file').click(function(e) {
          e.preventDefault();
          if ($('#main_file').hasClass('side_by_side')) {
            $('#main_file').removeClass('side_by_side');
          } else {
            $('#main_file').addClass('side_by_side');
          }
        
          $('#test_file').toggle();
        });

        $('#test_file').hide();
        
        function cleanString(str) {
          return $.trim(str.replace(/<[^(<|>)]+>/gi, ''));
        }
        
        $('.line_number').hover(function() {
          $(this).attr('title', 'Line: ' + cleanString($(this).html()));
        });
        
        $('.hit_number').hover(function() {
          $(this).attr('title', 'Execution Count: ' + cleanString($(this).html()));
        });
        
        $('.code_line').hover(function() {
          $(this).attr('title', cleanString($(this).html()));
        });
        
      });
    </script>
  </head>
  <body>
    <h1><a href="../../index.html">Coverage Report</a></h1>
    
    <table cellpadding='0' cellspacing='1'>
      <tr class='header'>
        <th>File</th>
        <th>Lines</th>
        <th>Lines Of Code</th>
        <th>Tested %</th>
      </tr>
      <tr valign='top'>
        <td>
          app/models/search_schedule.rb
          
        </td>
        <td>139</td>
        <td>82</td>
        <td>90.2%</td>
      </tr>
    </table>

    <div>&nbsp;</div>
    
    <table cellpadding='0' cellspacing='1'>
      <tr>
        <th>Legend</th>
      </tr>
      <tr>
        <td class='hit'>This line was executed.</td>
      </tr>
      <tr>
        <td class='miss'>This line was not executed!</td>
      </tr>
      <tr>
        <td class='never'>This line doesn't matter.</td>
      </tr>
    </table>
    
    <div>&nbsp;</div>

    <div id='content'>
      <div id='main_file'>
        <table id='main'>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>1</td>
              <td class='code_line'>
                <pre>class SearchSchedule < ActiveRecord::Base</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>2</td>
              <td class='code_line'>
                <pre>  RUFUS_TAG = "search_schedule"  </pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>3</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>4</td>
              <td class='code_line'>
                <pre>  belongs_to :search_setup</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>5</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>6</td>
              <td class='code_line'>
                <pre>  #reload all SearchSchedules within the given scheduler</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>7</td>
              <td class='code_line'>
                <pre>  def self.reset_schedule scheduler, log=nil</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>8</td>
              <td class='code_line'>
                <pre>    begin</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>9</td>
              <td class='code_line'>
                <pre>    log.info "#{Time.now}: Resetting Scheduled Jobs" if log</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>10</td>
              <td class='code_line'>
                <pre>    #unschedule all jobs</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>11</td>
              <td class='code_line'>
                <pre>    jobs = scheduler.find_by_tag(RUFUS_TAG) </pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>12</td>
              <td class='code_line'>
                <pre>    log.info "#{Time.now}: #{jobs.length} jobs to be removed." if log</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>13</td>
              <td class='code_line'>
                <pre>    jobs.each {|job| </pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>14</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Removing job #{job.job_id}" if log</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>15</td>
              <td class='code_line'>
                <pre>      scheduler.unschedule job.job_id</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>16</td>
              <td class='code_line'>
                <pre>    }</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>17</td>
              <td class='code_line'>
                <pre>    #schedule all</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>18</td>
              <td class='code_line'>
                <pre>    SearchSchedule.all.each {|ss| ss.schedule scheduler, log}</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>19</td>
              <td class='code_line'>
                <pre>    rescue Exception => e</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>20</td>
              <td class='code_line'>
                <pre>      if log</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>21</td>
              <td class='code_line'>
                <pre>        log.error e.message</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>22</td>
              <td class='code_line'>
                <pre>      else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>23</td>
              <td class='code_line'>
                <pre>        raise e</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>24</td>
              <td class='code_line'>
                <pre>      end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>25</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>26</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>27</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>28</td>
              <td class='code_line'>
                <pre>  def run log=nil</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>29</td>
              <td class='code_line'>
                <pre>    log.info "#{Time.now}: Search schedule #{self.id} starting." if log</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>30</td>
              <td class='code_line'>
                <pre>    srch_setup = self.search_setup</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>31</td>
              <td class='code_line'>
                <pre>    cm = CoreModule.find_by_class_name srch_setup.module_type</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>32</td>
              <td class='code_line'>
                <pre>    t = Tempfile.open("scheduled_search_run")</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>33</td>
              <td class='code_line'>
                <pre>    t.write CsvMaker.new.make(srch_setup,cm,srch_setup.search)</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>34</td>
              <td class='code_line'>
                <pre>    t.close</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>35</td>
              <td class='code_line'>
                <pre>    send_email srch_setup.name, t, log</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>36</td>
              <td class='code_line'>
                <pre>    send_ftp srch_setup.name, t, log</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>37</td>
              <td class='code_line'>
                <pre>    log.info "#{Time.now}: Search schedule #{self.id} complete." if log</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>38</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>39</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>40</td>
              <td class='code_line'>
                <pre>  def schedule(scheduler, log=nil)</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>41</td>
              <td class='code_line'>
                <pre>    begin</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>42</td>
              <td class='code_line'>
                <pre>      cs = cron_string</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>43</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Attempting to schedule job for Schedule #{self.id}, with cron \"#{cs}" if log</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>44</td>
              <td class='code_line'>
                <pre>      scheduler.cron cs, {:tags=> RUFUS_TAG} { SearchSchedule.find(self.id).run log } if any_days_scheduled? && self.run_hour</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>45</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Scheduled job for Schedule #{self.id}, with cron \"#{cs}\"" if log</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>46</td>
              <td class='code_line'>
                <pre>    rescue StandardException => e</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>47</td>
              <td class='code_line'>
                <pre>      if log</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>48</td>
              <td class='code_line'>
                <pre>        log.error e</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>49</td>
              <td class='code_line'>
                <pre>      else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="miss" data-hits='#{cov}'"">
              <td class='line_number'>50</td>
              <td class='code_line'>
                <pre>        raise e</pre>
              </td>
              <td class='hit_number'>0</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>51</td>
              <td class='code_line'>
                <pre>      end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>52</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>53</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>54</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>55</td>
              <td class='code_line'>
                <pre>  def is_running?</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>56</td>
              <td class='code_line'>
                <pre>    if self.last_start_time.nil?</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>57</td>
              <td class='code_line'>
                <pre>      return false</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>58</td>
              <td class='code_line'>
                <pre>    elsif self.last_finish_time.nil?</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>59</td>
              <td class='code_line'>
                <pre>      return true</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>60</td>
              <td class='code_line'>
                <pre>    elsif self.last_start_time > self.last_finish_time</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>61</td>
              <td class='code_line'>
                <pre>      return true</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>62</td>
              <td class='code_line'>
                <pre>    else</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>63</td>
              <td class='code_line'>
                <pre>      return false</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>64</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>65</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>66</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>67</td>
              <td class='code_line'>
                <pre>  private</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>68</td>
              <td class='code_line'>
                <pre>  def send_email name, temp_file, log=nil</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>69</td>
              <td class='code_line'>
                <pre>    if !self.email_addresses.nil? && self.email_addresses.include?("@")</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>70</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Attempting to send email to #{self.email_addresses}" if log</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>71</td>
              <td class='code_line'>
                <pre>      OpenMailer.send_search_result(self.email_addresses, name, temp_file.path).deliver!</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>72</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Sent email" if log</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>73</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>74</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>75</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>76</td>
              <td class='code_line'>
                <pre>  def send_ftp name, temp_file, log=nil</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>77</td>
              <td class='code_line'>
                <pre>    unless [self.ftp_server.blank?,</pre>
              </td>
              <td class='hit_number'>15</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>78</td>
              <td class='code_line'>
                <pre>      self.ftp_username.blank?,</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>79</td>
              <td class='code_line'>
                <pre>      self.ftp_password.blank?,</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>80</td>
              <td class='code_line'>
                <pre>    ].include? true</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>81</td>
              <td class='code_line'>
                <pre>      log.info "#{Time.now}: Attempting to send FTP to #{self.ftp_server}" if log</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>82</td>
              <td class='code_line'>
                <pre>      opts = {:remote_file_name => sanitize_filename("#{name}.csv")}</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>83</td>
              <td class='code_line'>
                <pre>      opts[:folder] = self.ftp_subfolder unless self.ftp_subfolder.blank?</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>84</td>
              <td class='code_line'>
                <pre>      begin</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>85</td>
              <td class='code_line'>
                <pre>        FtpSender.send_file self.ftp_server, self.ftp_username, self.ftp_password, temp_file.path, opts</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>86</td>
              <td class='code_line'>
                <pre>      rescue IOError => e</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>87</td>
              <td class='code_line'>
                <pre>        #do email & internal message here</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>88</td>
              <td class='code_line'>
                <pre>        log.error e.message if log</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>89</td>
              <td class='code_line'>
                <pre>        user = self.search_setup.user</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>90</td>
              <td class='code_line'>
                <pre>        OpenMailer.send_search_fail(user.email,self.search_setup.name,e.message,self.ftp_server,self.ftp_username,self.ftp_subfolder).deliver</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>91</td>
              <td class='code_line'>
                <pre>        user.messages.create(:subject=>"Search Transmission Failure",:body=>"Search Name: #{self.search_setup.name}\r"+</pre>
              </td>
              <td class='hit_number'>5</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>92</td>
              <td class='code_line'>
                <pre>          "Server Name: #{self.ftp_server}\r"+</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>93</td>
              <td class='code_line'>
                <pre>          "Account: #{self.ftp_username}\r"+</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>94</td>
              <td class='code_line'>
                <pre>          "Subfolder: #{self.ftp_subfolder}\r"+</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>95</td>
              <td class='code_line'>
                <pre>          "Error Message: #{e.message}")</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>96</td>
              <td class='code_line'>
                <pre>      end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>97</td>
              <td class='code_line'>
                <pre>      "#{Time.now}: FTP complete"</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>98</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>99</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>100</td>
              <td class='code_line'>
                <pre>  </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>101</td>
              <td class='code_line'>
                <pre>  def cron_string</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>102</td>
              <td class='code_line'>
                <pre>    return nil unless any_days_scheduled?</pre>
              </td>
              <td class='hit_number'>45</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>103</td>
              <td class='code_line'>
                <pre>    tz = search_setup.user.time_zone.nil? ? "America/New_York" : ActiveSupport::TimeZone::MAPPING[search_setup.user.time_zone]</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>104</td>
              <td class='code_line'>
                <pre>    "0 #{run_hour} * * #{make_days_of_week} #{tz}"</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>105</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>106</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>107</td>
              <td class='code_line'>
                <pre>  def any_days_scheduled?</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>108</td>
              <td class='code_line'>
                <pre>    self.run_sunday || </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>109</td>
              <td class='code_line'>
                <pre>    self.run_monday ||</pre>
              </td>
              <td class='hit_number'>90</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>110</td>
              <td class='code_line'>
                <pre>    self.run_tuesday ||</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>111</td>
              <td class='code_line'>
                <pre>    self.run_wednesday ||</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>112</td>
              <td class='code_line'>
                <pre>    self.run_thursday || </pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>113</td>
              <td class='code_line'>
                <pre>    self.run_friday ||</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>114</td>
              <td class='code_line'>
                <pre>    self.run_saturday</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>115</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>116</td>
              <td class='code_line'>
                <pre>  def make_days_of_week</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>117</td>
              <td class='code_line'>
                <pre>    d = []</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>118</td>
              <td class='code_line'>
                <pre>    d << "0" if self.run_sunday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>119</td>
              <td class='code_line'>
                <pre>    d << "1" if self.run_monday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>120</td>
              <td class='code_line'>
                <pre>    d << "2" if self.run_tuesday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>121</td>
              <td class='code_line'>
                <pre>    d << "3" if self.run_wednesday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>122</td>
              <td class='code_line'>
                <pre>    d << "4" if self.run_thursday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>123</td>
              <td class='code_line'>
                <pre>    d << "5" if self.run_friday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>124</td>
              <td class='code_line'>
                <pre>    d << "6" if self.run_saturday</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>125</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>126</td>
              <td class='code_line'>
                <pre>    return CSV.generate_line(d,{:row_sep=>""})</pre>
              </td>
              <td class='hit_number'>20</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>127</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>128</td>
              <td class='code_line'>
                <pre>  def sanitize_filename(filename)</pre>
              </td>
              <td class='hit_number'>6</td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>129</td>
              <td class='code_line'>
                <pre>    filename.strip.tap do |name|</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>130</td>
              <td class='code_line'>
                <pre>      # NOTE: File.basename doesn't work right with Windows paths on Unix</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>131</td>
              <td class='code_line'>
                <pre>      # get only the filename, not the whole path</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>132</td>
              <td class='code_line'>
                <pre>      name.sub! /\A.*(\\|\/)/, ''</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>133</td>
              <td class='code_line'>
                <pre>      # Finally, replace all non alphanumeric, underscore</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>134</td>
              <td class='code_line'>
                <pre>      # or periods with underscore</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="hit" data-hits='#{cov}'"">
              <td class='line_number'>135</td>
              <td class='code_line'>
                <pre>      name.gsub! /[^\w\.\-]/, '_'</pre>
              </td>
              <td class='hit_number'>10</td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>136</td>
              <td class='code_line'>
                <pre>    end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>137</td>
              <td class='code_line'>
                <pre>  end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>138</td>
              <td class='code_line'>
                <pre></pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
            <tr class="never" "">
              <td class='line_number'>139</td>
              <td class='code_line'>
                <pre>end</pre>
              </td>
              <td class='hit_number'></td>
            </tr>
          
        </table>
      </div>
      
    </div>
    
    <p>Generated on: 2011-03-15 12:47:28 -0700</p>
  </body>
</html>