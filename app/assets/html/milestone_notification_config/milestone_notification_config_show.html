<div class="container">
  <div class="row">
    <div class="col-md-12">
      <chain-panel panel-title='Errors' panel-message="errorHandler.errorMessage" panel-type='panel-danger'></chain-panel>
    </div>
  </div>
</div>
<chain-loading-wrapper loading-flag='{{loadingFlag}}'>
  <div class='container'>
    <div class="row">
      <div class="col-md-12 text-center">
        <h1>315 Send Configuration</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3">
        <div class='form-group' ng-hide="config.module_type">
          <label for="mnc_module_type">Data Source</label>
          <select id="mnc_module_type" ng-model="config.module_type" class="form-control" ng-options="key as value for (key, value) in moduleTypes" ng-change="getModelFields()"/>
        </div>
        <div class="form-group" ng-show="config.module_type">
          <label>Data Source</label> {{moduleTypes[config.module_type]}}
        </div>
        <div ng-show="config.module_type">
          <div class="form-group">
            <label>315 Sending Enabled? <input type="checkbox" ng-model="config.enabled"></label>
          </div>
          <div class="form-group">
            <label>Testing? <input type="checkbox" ng-model="config.testing"></label>
          </div>
          <div class="form-group">
            <label for="mnc_cust_no">Customer Number</label>
            <input type="text" ng-model="config.customer_number" id="mnc_cust_no" class="form-control">
          </div>
          <div class='form-group'>
            <label for="mnc_output_style">Output Style</label>
            <select id="mnc_output_style" ng-model="config.output_style" class="form-control" ng-options="key as value for (key, value) in outputStyles" />
          </div>
        </div>
      </div>
      <div class="col-md-9" ng-show="modelFieldList && modelFieldList.length > 0">
        <label>315 Output Filters (All filters must match entry for a 315 to be sent)</label>
        <div chain-search-criteria bound-item="config" model-fields="modelFieldList" />
      </div>
      <div class="col-md-9" ng-show="modelFieldList && modelFieldList.length > 0" style="margin-top: 20px;">
        <label>Fingerprint Fields - If any of the following field's change values new 315s will be sent for all events.</label>
        <table class="table table-striped">
          <tbody>
            <tr ng-repeat="field in config.setup_json.fingerprint_fields track by $index">
              <td><select ng-model="config.setup_json.fingerprint_fields[$index]" class="form-control" ng-options="mf.mfid as mf.label for mf in modelFieldList" /></td>
              <td><button type="button" class="btn btn-danger" ng-click="removeFingerprintField(field)">
                  <span class="fa fa-trash"></span>
                </button></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="2" class="text-center"><button type="button" class="btn btn-secondary" ng-click="addFingerprintField()">Add Field</button></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    <div class="row" ng-show="eventList && eventList.length > 0">
      <div class="col-md-12 text-center">
        <h2>Event Codes To Send</h2>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>&nbsp;</th>
              <th>Event Code</th>
              <th>Only send Event Date<br>(No Time)?</th>
              <th>Convert Event Date to Time Zone<br>(Blank = US Eastern)</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="event in config.setup_json.milestone_fields">
              <td>
                <button type="button" class="btn btn-danger" ng-click="removeEvent(event)">
                  <span class="fa fa-trash"></span>
                </button>
              </td>
              <td>
                <select ng-model="event.model_field_uid" class="form-control" ng-options="mf.mfid as mf.label for mf in eventList" />
              </td>
              <td>
                <input type="checkbox" ng-model="event.no_time">
              </td>
              <td>
                <select ng-model="event.timezone" class="form-control" ng-options="z.name as z.label for z in timezones" />
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="text-center"><button type="button" class="btn btn-secondary" ng-click="newEvent()">New Event</button></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</chain-loading-wrapper>
<div chain-action-bar>
  <button type="button" class="btn btn-secondary" ng-click="cancel()">Cancel</button>
  <button class="btn btn-secondary" ng-show="config.id > 0" ng-click="copyConfig()">Copy</button>
  <button class="btn btn-secondary" ng-click="saveConfig()">Save</button>
</div>
