<div id='advanced_search_wrapper'>
  <div chain-messages errors='errors' notices='notices'></div>
  <div ng-show='searchSetup.id'>
    <div class='container'>
      <div class='row text-center'>
        <div class='col-md-12'>
          <select class='form-control input-lg' ng-hide='showSetup' id='select_search' ng-model='searchId' ng-change='changeSearch(searchId)' ng-options='s.id as s.name for s in searchSetup.search_list'>
          </select>
        </div>
      </div>
    </div>
    <div id='search_setup_controls' ng-show='showSetup' class='container'>
      <div class='well'>
        <div class='row text-center'>
          <div class='col-md-12'>
            <h2>Setup</h2>
            <input id='search-setup-name-box' type='text' ng-model='searchSetup.name' class='form-control input-lg' />
          </div>
        </div>
        <div class='row' style='margin-top:20px;'>
          <div class='col-md-4 col-md-offset-1'>
            <input type='checkbox' ng-model='searchSetup.include_links'/> Include Links In Download
          </div>
          <div class='col-md-4'>
            <input type='checkbox' ng-model='searchSetup.no_time'/> Hide Time
          </div>
        </div>
        <hr />
        <!--column setup-->
        <div class='row'>
          <div class='col-md-12 text-center'>
            <h3>Columns</h3>
          </div>
        </div>
        <div class='row'>
          <div class='col-md-6'>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <h5>Available</h5>
              </div>
            </div>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <select class='form-control' multiple='multiple' size='10' ng-model='columnsToAdd' ng-options='s.mfid as s.label for s in availableColumns | filter:columnFilter'>
                </select>
                <div>
                  <input class='form-control' type='text' ng-model='columnFilter' placeholder='Search columns...' />
                </div>
                <div>
                  <a ng-show='columnsToAdd' class='btn btn-default' ng-click='addColumns()'>Add</a> 
                  <a class='btn btn-default' ng-click='addBlank()'>Add Blank</a>&nbsp;
                </div>
              </div>
            </div>
          </div>
          <div class='col-md-6'>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <h5>Included</h5>
              </div>
            </div>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <select class='form-control' multiple='multiple' size='10' ng-model='columnsToRemove' ng-options='s.mfid as s.label for s in searchSetup.search_columns'>
                </select>
                <br />
                <div ng-hide='columnsToRemove'>&nbsp;</div>
                <div ng-show='columnsToRemove'>
                  <a class='btn btn-default' ng-click='removeColumns()'>Remove</a>
                  <a class='btn btn-default' ng-click='moveColumnsUp()'>Up</a>
                  <a class='btn btn-default' ng-click='moveColumnsDown()'>Down</a>
                </div>
              </div>
            </div>
          </div>
        </div>  
        <hr />
        <!--sort setup-->
        <div class='row'>
          <div class='col-md-12 text-center'>
            <h3>Sorts</h3>
          </div>
        </div>
        <div class='row'>
          <div class='col-md-6'>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <h5>Available</h5>
              </div>
            </div>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <select class='form-control' id='availableSorts' multiple='multiple' size='10' ng-model='sortsToAdd' ng-options='s.mfid as s.label for s in availableSorts | filter:sortFilter'>
                </select>
                <div>
                  <input class='form-control' type="text" ng-model="sortFilter" placeholder="Search sorts...">
                </div>
                <div>
                  <div ng-hide='sortsToAdd'>&nbsp;</div>
                  <div ng-show='sortsToAdd'>
                    <a ng-show='sortsToAdd' class='btn btn-default' ng-click='addSorts()'>Add</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class='col-md-6'>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <h5>Included</h5>
              </div>
            </div>
            <div class='row'>
              <div class='col-md-12 text-center'>
                <select class='form-control' multiple='multiple' size='10' ng-model='sortsToRemove' ng-options='s.mfid as s.label + descendingLabel(s.descending) for s in searchSetup.sort_criterions'>
                </select>
                <br />
                <div ng-hide='sortsToRemove'>&nbsp;</div>
                <div ng-show='sortsToRemove'>
                  <a class='btn btn-default' ng-click='removeSorts()'>Remove</a>
                  <a class='btn btn-default' ng-click='moveSortsUp()'>Up</a>
                  <a class='btn btn-default' ng-click='moveSortsDown()'>Down</a>
                  <a class='btn btn-default' ng-click='toggleSort()'>Change Order</a>
                </div>
              </div>
            </div>
          </div>
        </div>  
        <hr />
        <!-- Parameter setup-->
        <div class='row'>
          <div class='col-md-12 text-center'>
            <h3>Parameters</h3>
          </div>
        </div>
        <div ng-repeat='crit in searchSetup.search_criterions'>
          <div chain-search-criterion='crit' model-fields="searchSetup.model_fields"></div>
        </div>
        <div class='row'>
          <div class='col-md-12 form-inline'>
            Add New: <select class='form-control' style='width:30%;' ng-model='criterionToAdd' ng-options='f.mfid as f.label for f in searchSetup.model_fields'>
            </select>
            <button ng-show='criterionToAdd' class='btn btn-default' ng-click='addCriterion(criterionToAdd)'>Add</button>
          </div>
        </div>
        <!-- Schedule Setup -->
        <div class='row'>
          <div class='col-md-12 text-center'>
            <h3>Schedules</h3>
          </div>
        </div>
        <div class='row'>
          <div ng-hide='scheduleToEdit'>
            <ul class='thumbnails'>
              <li class='col-md-6' ng-repeat='sched in searchSetup.search_schedules'>
                <div class='thumbnail schedule-display'>
                  <p>
                    <strong>To:</strong> {{sched.email_addresses}}
                  </p>
                  <p>
                    <strong>At:</strong> {{scheduleTimingText(sched)}}
                  </p>
                  <p>
                    <strong>As:</strong> {{sched.download_format}} 
                  </p>
                  <p>
                    <span ng-show='sched.ftp_server'><strong>{{scheduleProtocol(sched)}} Server:</strong> {{sched.ftp_server}}<br /></span>
                  </p>
                  <div class='text-center'>
                    <button class='btn btn-default' ng-click='editSchedule(sched)'>Edit</button> <button class='btn btn-default' ng-click='removeSchedule(sched)'>Remove</button>
                  </div>
                </div>
              </li>
            </ul>
            <div class='row text-center'>
              <div class='col-md-12'>
                <a class='btn btn-default' ng-click='addSchedule()'>Add Schedule</a>
              </div>
            </div>
          </div>
          <div class='form-horizontal' ng-show='scheduleToEdit'>
            <div class='row'>
              <div class='col-md-6'>
                <div class='control-group'>
                  <label class='control-label' for='sched-email-addresses'>Email</label>
                  <div class='controls'>
                    <textarea class='form-control' id='sched-email-addresses' ng-model='scheduleToEdit.email_addresses' rows='4' data-/>
                    <br />
                    <small class='muted'>
                      Separate addresses with commas.
                    </small>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label' for='sched-format'>Format</label>
                  <div class='controls'>
                    <select class='form-control' id='sched-format' ng-model='scheduleToEdit.download_format'>
                      <option>csv</option>
                      <option>xls</option>
                    </select>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label' for='sched-time'>Time</label>
                  <div class='controls'>
                    <select class='form-control' id='sched-time' ng-model='scheduleToEdit.run_hour'>
                      <option value='0'>midnight</option>
                      <option value='1'>1:00am</option>
                      <option value='2'>2:00am</option>
                      <option value='3'>3:00am</option>
                      <option value='4'>4:00am</option>
                      <option value='5'>5:00am</option>
                      <option value='6'>6:00am</option>
                      <option value='7'>7:00am</option>
                      <option value='8'>8:00am</option>
                      <option value='9'>9:00am</option>
                      <option value='10'>10:00am</option>
                      <option value='11'>11:00am</option>
                      <option value='12'>noon</option>
                      <option value='13'>1:00pm</option>
                      <option value='14'>2:00pm</option>
                      <option value='15'>3:00pm</option>
                      <option value='16'>4:00pm</option>
                      <option value='17'>5:00pm</option>
                      <option value='18'>6:00pm</option>
                      <option value='19'>7:00pm</option>
                      <option value='20'>8:00pm</option>
                      <option value='21'>9:00pm</option>
                      <option value='22'>10:00pm</option>
                      <option value='23'>11:00pm</option>
                    </select>
                  </div>
                </div>
                <div class='control-group'>
                  <label class='control-label' for='sched-dom'>Day of Month</label>
                  <div class='controls'>
                    <select class='form-control' id='sched-dom' ng-model='scheduleToEdit.day_of_month'>
                      <option></option>
                      <option>1</option>
                      <option>2</option>
                      <option>3</option>
                      <option>4</option>
                      <option>5</option>
                      <option>6</option>
                      <option>7</option>
                      <option>8</option>
                      <option>9</option>
                      <option>10</option>
                      <option>11</option>
                      <option>12</option>
                      <option>13</option>
                      <option>14</option>
                      <option>15</option>
                      <option>16</option>
                      <option>17</option>
                      <option>18</option>
                      <option>19</option>
                      <option>20</option>
                      <option>21</option>
                      <option>22</option>
                      <option>23</option>
                      <option>24</option>
                      <option>25</option>
                      <option>26</option>
                      <option>27</option>
                      <option>28</option>
                    </select>
                  </div>
                </div>
                <div class='control-group' ng-hide='scheduleToEdit.day_of_month'>
                  <div class='controls'>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_monday'/> Monday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_tuesday'/> Tuesday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_wednesday'/> Wednesday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_thursday'/> Thursday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_friday'/> Friday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_saturday'/> Saturday</label>
                    <label class='checkbox'><input type='checkbox' ng-model='scheduleToEdit.run_sunday'/> Sunday</label>
                  </div>
                </div>
              </div>
              <div class='col-md-6'>
                <fieldset ng-show='searchSetup.allow_ftp'>
                  <div class='control-group'>
                    <label class='control-label' for='sched-f-protocol'>Use SFTP?</label>
                    <div class='controls'>
                      <input id='sched-f-protocol' type='checkbox' ng-model='scheduleToEdit.protocol' ng-true-value="sftp" ng-false-value="ftp"/>
                    </div>
                  </div>
                  <div class='control-group'>
                    <label class='control-label' for='sched-f-server'>{{scheduleProtocol(scheduleToEdit)}} Server</label>
                    <div class='controls'>
                      <input id='sched-f-server' class='form-control' type='text' ng-model='scheduleToEdit.ftp_server'/>
                    </div>
                  </div>
                  <div class='control-group'>
                    <label class='control-label' for='sched-f-user'>{{scheduleProtocol(scheduleToEdit)}} User</label>
                    <div class='controls'>
                      <input id='sched-f-user' class='form-control' type='text' ng-model='scheduleToEdit.ftp_username' />
                    </div>
                  </div>
                  <div class='control-group'>
                    <label class='control-label' for='sched-f-pass'>{{scheduleProtocol(scheduleToEdit)}} Password</label>
                    <div class='controls'>
                      <input id='sched-f-pass' class='form-control' type='text' ng-model='scheduleToEdit.ftp_password' />
                    </div>
                  </div>
                  <div class='control-group'>
                    <label class='control-label' for='sched-f-folder'>{{scheduleProtocol(scheduleToEdit)}} Folder</label>
                    <div class='controls'>
                      <input id='sched-f-folder' class='form-control' type='text' ng-model='scheduleToEdit.ftp_subfolder' />
                    </div>
                  </div>
                </fieldset>
              </div>
            </div>
            <div class='control-group'>
              <div class='controls'>
                <button class='btn btn-primary' ng-click='scheduleToEdit = null'>Done</button>
              </div>
            </div>
          </div>
        </div>
        <hr />
        <div id='search-setup-actions' class='row text-center'>
          <div class='btn-group' ng-hide='deletePrompt==true || givePrompt==true || copyPrompt==true'>
            <button class='btn btn-lg btn-success' ng-click='saveSetup()'>Save</button>
            <button class='btn btn-lg btn-default' ng-click='newSetup()'>New</button>
            <button class='btn btn-lg btn-default' ng-click='copyPrompt=true'>Copy</button>
            <button class='btn btn-lg btn-default' ng-click='givePrompt=true'>Give</button>
            <button class='btn btn-lg btn-danger' ng-click='deletePrompt=true'>Delete</button>
          </div>
          <div class='col-md-12 form-horizontal' ng-show='givePrompt==true'>
            Select User
            <div style='display:inline;' chain-user-list='giveUserId'></div>
            <a class='btn btn-primary' ng-click='give(giveUserId)' ng-show='giveUserId'>Give</a>
            <a class='btn btn-default' ng-click='givePrompt=false'>Cancel</a>
          </div>
          <div class='col-md-12 form-horizontal' ng-show='deletePrompt==true'>
            Really Delete?
            <a class='btn btn-danger' ng-click='deleteSetup()'>Yes</a>
            <a class='btn btn-default' ng-click='deletePrompt=false'>No</a>
          </div>
          <div class='col-md-12 form-horizontal' ng-show="copyPrompt==true">
            Copy As <input type="text" ng-model="copyReportName" class="input-xxlarge" placeholder="Enter copy name...">
            <a class='btn btn-lg btn-primary' ng-click='copy(copyReportName)'>Copy</a>
            <a class='btn btn-lg' ng-click='copyPrompt=false; copyReportName=""'>Cancel</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div chain-search-result='searchResult' page='page' errors='errors' src='/advanced_search/'>
    <button class='btn btn-default' ng-click='toggleSetup()' ng-show='searchSetup'> <span ng-show='showSetup'>Hide</span><span ng-hide='showSetup'>Show</span> Setup</button>
    <button class='btn btn-default' ng-show='searchResult.total_pages>1' ng-click='backgroundDownload()'>Download</button> 
    <a class='btn btn-default' ng-show='searchResult.total_pages<=1' href='/advanced_search/{{searchSetup.id}}/download.xls'>Download</a>
    <a class='btn btn-default' ng-show='searchSetup.uploadable_error_messages.length == 0' href='/search_setups/{{searchSetup.id}}/imported_files/new'>Upload</a>
    <span ng-show='searchSetup.uploadable_error_messages.length > 0'>
      <span chain-message-box title="'Upload'" as-button='true' extra-class="'btn-default'">
        <div ng-repeat='s in searchSetup.uploadable_error_messages'>
          {{s}}
        </div>
      </span>
    </span>
  </div>
</div>
