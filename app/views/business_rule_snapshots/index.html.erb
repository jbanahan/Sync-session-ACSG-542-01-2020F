<% # Cache key = Entry + all business validation results %>
<% content_for :action_bar do %>
  <button class='btn_link' link_to='<%=@back_path%>'><i class="fa fa-medkit" title="<%=@object_type%> Business Rules"></i></button>
<% end %>

<% content_for :head_tags do %>
<style type="text/css">
  .history-message { white-space: pre; padding: 5px; border: 1px solid lightgray; border-radius: 5px;}
</style>
<% end %>

<h2>Business Rule History for <%=@object_type%> <%=@object_key%></h2>

<table class="table table-hover table-striped">
  <thead>
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Status</th>
      <th>Message</th>
    </tr>
  </thead>
  <tbody>
  <% @rule_comparisons.each do |r| %>
    <tr>
      <td><%=r[:updated_at].try(:strftime, "%Y-%m-%d %l:%M %p")%></td>
      <td><span title="<%=r[:description]%>"><%=r[:name]%></span></td>
      <td><%=r[:state]%></td>
    <% if r[:overridden_at] %>
      <td><div>Overriden by <%=User.where(id: r[:overridden_by_id]).first.try(:full_name)%> at <%=r[:overridden_at].try(:strftime, "%Y-%m-%d %l:%M %p")%></div>
        <% if !r[:note].blank? %> <div class="history-message"><%=r[:note]%></div><% end %></td>
    <% else %>
      <td><%=r[:message]%></td>
    <% end %>
    </tr>
  <% end %>
  </tbody>
</table>