<div ng-app='HMApp'>
  <div class="container" ng-controller='HMPOLineController' ng-init='getLines()'>
    <div class="modal" id='issue_codes'>
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Issue Codes</h4>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          </div>
          <div class="modal-body">
            <dl class="dl-horizontal">
            <dt>GSPHTS</dt><dd>Wrong tariff number on GSP Form A</dd>
            <dt>GSPBAD</dt><dd>Mismatching information on the GSP Form A and invoices ( i.e. weight not matching with invoice, no. of cartons incorrect)</dd>
            <dt>GSPBBY</dt><dd>Missing GSP FORM A for baby sizes</dd>
            <dt>NODOCS</dt><dd>Docs in general delayed (shipment arrived, no docs for customs clearance received)</dd>
            <dt>BADDES</dt><dd>Incorrect/inscrutable/missing description and/or composition on the invoice ( i.e. just the STYLE-name instead of “ladies trousers woven”, blouse is shown item is a skirt, stated KNITTED but item is WOVEN)</dd>
            <dt>UNTPRC</dt><dd>Incorrect unit price on the invoice</dd>
            <dt>LTDOCS</dt><dd>Documents partly missing/delayed</dd>
            <dt>BADWGT</dt><dd>Weight on packing lists/invoice not the actual weight of the goods</dd>
            <dt>BADDOC</dt><dd>If docs were sent by scanned copy, very often the copies are not readable or blurred</dd>
            <dt>BADCTN</dt><dd>Deviation in number of cartons or pieces between supplier’s invoice and packing list</dd>
            </dl>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <chain-panel panel-title='Errors' panel-message="errorMessage" panel-type='panel-danger' />
    </div>
    <div class="row">
      <div class='col-md-12'>
        <h1>H&amp;M PO Lines</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <form class="form-inline">
          <input type='text' ng-model='searchPO' class='form-control' placeholder='PO number to edit'>
          <button ng-click='getLineByPO()' class='btn btn-primary' ng-disabled='searchPO.length!=6'>Load PO</button>
          <span class='text-warning' ng-show='searchPO && searchPO.length!=6'>PO Number must be 6 digits</span>
        </form>
        <hr />
      </div>
    </div>
    <div class="row" ng-hide='poLine || !missingPO'>
      <div class="col-md-12">
        <div class="card alert-warning">
            <div class="card-header">Order Not Found</div>
            <div class="card-body bg-white">
              Order {{missingPO}} was not found.  Would you like to create it?
            </div>
            <div class='card-footer'>
              <button ng-click='createPO()' class='btn btn-warning'>Create</button>
            </div>
        </div>
      </div>
    </div>
    <form name='form' novalidate ng-show='poLine'>
      <div class="row">
        <div class="col-md-12">
          <div class='form-group' ng-class="{'has-error':form.po_number.$invalid}">
            <label for='po_number'>PO Number</label>
            <input type='text' ng-model='poLine.po_number' class='form-control' name='po_number' id='po_number' ng-pattern='/^\d{6}$/' required>
            <span ng-show='form.po_number.$error.pattern' class='error'>PO Number must be 6 digits like &quot;123456&quot;.</span>
            <span ng-show='form.po_number.$error.required' class='error'>PO Number is required.</span>
          </div>
        </div>
      </div>
      <div class='row'>
        <div class='col-md-4'>
        <div class='form-group'>
            <label for='coast'>Coast</label>
            <select id='coast' name='coast' class='form-control' ng-model='poLine.coast' required>
              <option>East</option>
              <option>West</option>
            </select>
            <span ng-show='form.coast.$error.required' class='error'>Coast is required.</span>
          </div>
          <div class='form-group' ng-class="{'has-error':form.hts_code.$invalid}">
            <label for='hts_code'>HTS Number</label>
            <input type='text' ng-model='poLine.hts_code' class='form-control' id='hts_code' name='hts_code' ng-pattern='/^\d{10}$/'>
            <span ng-show='form.hts_code.$error.pattern' class='error'>HTS number must be 10 digits without periods.</span>
          </div>
          <div class='form-group'>
            <label for="mid">MID</label>
            <input id="mid" class="form-control" name='mid' ng-model="poLine.mid">
          </div>          
          <div class="form-group" ng-class="{'has-error':form.origin_country.$invalid}">
            <label for="" form="origin_country">Country of Origin</label>
            <input type="text" id="origin_country" class='form-control' name="origin_country" ng-model="poLine.origin_country" ng-pattern='/^[A-Z]{2}$/'>
            <span ng-show='form.origin_country.$error.pattern' class='error'>Country of origin must be two capital letters (US, CA, CN, etc).</span>
          </div>
          <div class='form-group' ng-class="{'has-error':form.quantity.$invalid}">
            <label for="quantity">Quantity</label>
            <input id="quantity" class="form-control" type="number" ng-model="poLine.quantity" name='quantity' ng-change='svc.recalc(poLine)' min='0'>
            <span ng-show='form.quantity.$error.min' class='error'>Quantity must be positive.</span>
          </div>
          <div class='form-group'>
            <label for="reporting_quantity">Reporting Quantity</label>
            <input id="reporting_quantity" class="form-control" type="number" ng-model="poLine.reporting_quantity">
          </div>
          <div class='form-group'>
            <label for="reporting_uom">Reporting UOM</label>
            <input id="reporting_uom" class="form-control" ng-model="poLine.reporting_uom">
          </div>
        </div>
        <div class='col-md-4'>
          <div class='form-group'>
            <label for="net_weight">Net Weight</label>
            <input id="net_weight" class="form-control" type="number" ng-model="poLine.net_weight">
          </div>
          <div class='form-group'>
            <label for="gross_weight">Gross Weight</label>
            <input id="gross_weight" class="form-control" type="number" ng-model="poLine.gross_weight">
          </div>
          <div class='form-group' ng-class="{'has-error':form.cartons.$invalid}">
            <label for="cartons">Cartons</label>
            <input id="cartons" class="form-control" type="number" name='cartons' ng-model="poLine.cartons">
            <span ng-show='form.cartons.$error.min'>Cartons must be positive.</span>
          </div>
          <div class='form-group' ng-class="{'has-error':form.unit_cost.$invalid}">
            <label for="unit_cost">Unit Cost</label>
            <input id="unit_cost" class="form-control" type="number" name='unit_cost' ng-model="poLine.unit_cost" ng-change='svc.recalc(poLine)' min='0'>
            <span ng-show='form.unit_cost.$error.min' class='error'>Unit Cost must be positive.</span>
          </div>
          <div class='form-group' ng-class="{'has-error':form.currency.$invalid}">
            <label for="currency">Currency</label>
            <select id="currency" class="form-control" type="text" name='currency' ng-model="poLine.currency">
              <option>USD</option>
              <option>EUR</option>
              <option>SEK</option>
            </select>
          </div>
          <div class='form-group'>
            <label for="invoice_value">Invoice Value (Foreign)</label>
            <input id="invoice_value" class="form-control" type="number" ng-model="poLine.invoice_value">
          </div>
          <div class='form-group'>
            <label for="adjusted_value">Adjusted Value (Foreign)</label>
            <input id="adjusted_value" class="form-control" type="number" ng-model="poLine.adjusted_value">
          </div>
        </div>
        <div class="col-md-4">
          <div class='form-group'>
            <label for="docs_rec_date">Docs Received</label>
            <input id="docs_rec_date" name='docs_rec_date' type="date" ng-model="poLine.docs_rec_date" class='form-control' required>
            <span ng-show='form.docs_rec_date.$error.required' class='error'>Docs Received Date is required.</span>
          </div>
          <div class='form-group'>
            <label for="docs_ok_date">Docs OK</label>
            <input id="docs_ok_date" type="date" ng-model="poLine.docs_ok_date" class='form-control'>
          </div>
          <div class='form-group'>
            <label for="issue_codes">Issue Codes <button class='btn btn-sm' data-toggle='modal' data-target='#issue_codes'>?</button></label>
            <input type="text" id="issue_codes" ng-model='poLine.issue_codes' class='form-control' />
          </div>
          <div class='form-group'>
            <label for="comment">Comment</label>
            <textarea ng-model='poLine.comment' class='form-control' id='comment'></textarea>
          </div>
          
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button class='btn btn-primary' ng-click='saveLine(poLine)' ng-disabled="form.$invalid">{{poLine.id ? "Update" : "Add"}}</button>
          <span class='badge badge-success' ng-show='actionResponse'>{{actionResponse}}</span>
        </div>
      </div>
    </form>
    <div class="row">
      <div class="col-md-12">
        <h2>Recent Lines</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <form class="form-inline">
          <input ng-model='searchValue'  class='form-control'/>
          <button ng-click='getLines()' class='btn btn-secondary'>Search</button>
        </form>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div ng-show='loadingLines'>
          Loading...
        </div>
        <table class="table table-striped" ng-hide='loadingLines'>
          <thead>
            <tr>
              <th>PO</th>
              <th>Coast</th>
              <th>HTS</th>
              <th>Cartons</th>
              <th>Quantity</th>
              <th>Unit Cost</th>
              <th>Invoice Value</th>
              <th>Adjusted Value</th>
              <th>Currency</th>
              <th>Docs Rcvd</th>
              <th>Docs OK</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat='line in recentLines'>
              <td><a class='btn btn-sm' ng-click='selectLine(line)'>{{line.po_number}}</a></td>
              <td>{{line.coast}}</td>
              <td>{{line.hts_code}}</td>
              <td>{{line.cartons}}</td>
              <td>{{line.quantity}}</td>
              <td>{{line.unit_cost}}</td>
              <td>{{line.invoice_value}}</td>
              <td>{{line.adjusted_value}}</td>
              <td>{{line.currency}}</td>
              <td>{{line.docs_rec_date}}</td>
              <td>{{line.docs_ok_date}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div chain-action-bar>
      <button class='btn btn-secondary'>Send Log</button>
    </div>
  </div>
</div>
