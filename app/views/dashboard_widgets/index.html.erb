<%content_for :javascript do -%>
$(function() {
  $(document).ready(function() {
    <%if current_user.view_official_tariffs? && !current_user.hide_message?('wh2')-%>

      $("#what-happened").modal();
      $("#never-show").click(function() {
        $("#what-happened").modal('hide');
        Chain.hideMessage('wh2');
      });
      $("#what-happened-close").click(function() {
        $("#what-happened").modal('hide');
      });
    <%end-%>
    $("#btn_tour").click(function() {
      bootstro.start('',{items:[
         {selector:'#leftnav',placement:'bottom',content:'Move between system modules and build custom searches here.'},
         {selector:'#menu_dropdown',placement:'bottom',content:'Manage your account and access extra settings here.'},
         {selector:'#quick_search_input',placement:'bottom',content:'Search for items here.'},
         {selector:'#nav-help-anchor',placement:'top',content:"Each page's action buttons are down here.",width:'400px'}
        ]});
    });
    $(".widget_box").each(function() {
      $(this).scope().loadWidget($(this).attr('widget-id'))
    })
  });
});
<%end-%>
<%content_for :action_bar do -%>
  <span id='nav-help-anchor'>&nbsp;</span>
  <%unless current_user.search_setups.empty? -%>
    <button class='btn_link' link_to='<%=edit_dashboard_widgets_path%>'>Setup</button>
  <%end-%>
<%end-%>
<div id='ng-app' ng-app='DashboardApp'>
  <div chain-messages errors='errors' notices='notices'></div>
  <%if @widgets.blank? -%>
    <div class='container'>
      <div class='row'>
        <div class='span12 jumbotron'>
          <h1>Welcome!</h1>
          <% if current_user.search_setups.empty? -%>
            <p>This is your personal dashboard. Once you've setup some searches, you'll be able to add them here.</p>
          <% elsif @widgets.empty? -%>
            <p>Click the setup link at the bottom of the page to add some of your searches to your dashboard.</p>
          <% end -%>
          <p>
            <button id='btn_tour' class='btn btn-large btn-primary'>Click for a quick tour</button>
          </p>
        </div>
      </div>
    </div>
  <%else-%>
    <h1 class='text-center'>Dashboard</h1>
    <%@widgets.each do |w| -%>
      <div ng-controller='DashboardViewController' class='widget_box' widget-id='<%=w.search_setup_id%>'>
        <h2 ng-show='widget.name' class='widget_heading' >{{widget.name}} - {{widget.core_module_name}}</h2>
        <div chain-search-result='widget' per-page='perPage' page='page' no-chrome='true' src='/advanced_search/'></div>
        <a ng-show='widget.name' class='action_link' href='/advanced_search/<%=w.search_setup_id%>'>More</a>
      </div>
    <%end -%>
  <%end -%>
</div>
<%if current_user.view_official_tariffs? && !current_user.hide_message?('wh2')-%>
  <div id='what-happened' class='modal fade'>
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h3>New Feature: Tariff Update Subscriptions</h3>
        </div>
        <div class='modal-body'>
          <p>
            You can now elect to receive an email notification every time the tariff database is updated with new regulatory information: 
          </p>
          <p>
            To subscribe to notifications:
          </p>
          <ul>
            <li>Click on your name at the top right corner of the screen</li>
            <li>Click Account</li>
            <li>Check the <em>Email Me When Tariffs Are Updated</em> box</li>
            <li>Click Save</li>
          </ul>
        </div>
        <div class='modal-footer'>
          <button class='btn' id='never-show'>Never Show This Again</button>
          <button class='btn btn-primary' id='what-happened-close'>Close</button>
        </div>
      </div>
    </div>
  </div>
<%end-%>
