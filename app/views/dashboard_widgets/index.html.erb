<% content_for :javascript do %>
$(function () {
<% @widgets.each do |w|%>
  $.getJSON('<%="#{url_for(Kernel.const_get(w.search_setup.module_type))}.json?sid=#{w.search_setup_id}"%>', function(data) {
    var h = '<h2>'+data.name+'</h2><table class="detail_table"><thead><tr>';
    var i;
    for(i=0;i<data.columns.length;i++) {
      h += '<th>'+data.columns[i]+'</th>';
    }
    h+='<th></th></tr></thead><tbody>';
    for(i=0;i<data.records.length;i++) {
      h += '<tr class="hover">';
      var j;
      for(j=0;j<data.records[i].data.length;j++) {
        h += '<td>'+data.records[i].data[j]+'</td>';
      }
      h += '<td><a href="'+data.records[i].url+'">Go</a></td></tr>';
    }
    h+= '</table>';
    $("#widget_content_<%=w.id%>").html(h);
  });
<% end %>
});
<% end %>

<% @widgets.each do |w| %>

<div class='widget_box'>
  <div id='widget_content_<%=w.id%>'>
  <h2><%=w.search_setup.name%></h2>
  Loading...<br />
  <%=image_tag "ajax-loader.gif" %>
  </div>
<%=link_to "Full Search", "#{url_for(Kernel.const_get(w.search_setup.module_type))}.json?sid=#{w.search_setup_id}"%><br />
</div>
<%end%>
