<%content_for :javascript do -%>
$(function() {
  $(document).ready(function() {
    $("#btn_tour").click(function() {
      Chain.showNavTour();
    });
    $(".widget_box").each(function() {
      $(this).scope().loadWidget($(this).attr('widget-id'))
    })
  });
});
<%end-%>
<%content_for :action_bar do -%>
  <span id='nav-help-anchor'>&nbsp;</span>
  <%unless current_user.search_setups.empty? -%>
    <button class='btn_link' link_to='<%=edit_dashboard_widgets_path%>'>Setup</button>
  <%end-%>
<%end-%>
<div id='ng-app' ng-app='DashboardApp'>
  <div chain-messages errors='errors' notices='notices'></div>
  <%if @widgets.blank? -%>
    <div class='container'>
      <div class='row'>
        <div class='col-md-12 jumbotron'>
          <h1>Welcome!</h1>
          <% if current_user.search_setups.empty? -%>
            <p>This is your personal dashboard. Once you've setup some searches, you'll be able to add them here.</p>
          <% elsif @widgets.empty? -%>
            <p>Click the setup link at the bottom of the page to add some of your searches to your dashboard.</p>
          <% end -%>
          <p>
            <button id='btn_tour' class='btn btn-lg btn-primary'>Click for a quick tour</button>
          </p>
        </div>
      </div>
    </div>
  <%else-%>
    <h1 class='text-center'>Dashboard</h1>
    <%@widgets.each do |w| -%>
      <div ng-controller='DashboardViewController' class='widget_box' widget-id='<%=w.search_setup_id%>'>
        <h2 ng-show='widget.name' class='widget_heading' >{{widget.name}} - {{widget.core_module_name}}</h2>
        <div chain-search-result='widget' per-page='perPage' page='page' no-chrome='true' src='/advanced_search/'></div>
        <a ng-show='widget.name' class='action_link' href='/advanced_search/<%=w.search_setup_id%>'>More</a>
      </div>
    <%end -%>
  <%end -%>
</div>