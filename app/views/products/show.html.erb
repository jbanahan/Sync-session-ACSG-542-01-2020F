<% content_for :javascript do %>
  $(function() {
  <% if @product.can_edit?(current_user)%>
    $( "#btn_edit" )
      .button()
      .click(function() {
        window.location = '<%=edit_product_path(@product)%>';
      });
    $("#mod_inventory").dialog({autoOpen:false,title:"Adjust Inventory",
      buttons:{"Adjust":function() {$("#frm_inv").submit();}}});
    $( "#btn_adj_inventory").button().click(function() {
      $("#mod_inventory").dialog('open');
    });
  <% end %>
    $("#mod_subscriptions").dialog({autoOpen:false,title:"Subscriptions",
      buttons:{"Subscribe":function() {$("#frm_sub").submit();}}});
    $("#btn_subscriptions")
      .button()
      .click(function() {
        $("#mod_subscriptions").dialog('open');
      });
    $("#btn_order_jump")
      .button()
      .click(function() {
        window.location = '<%=raw url_for(:action => :index, :controller => :orders, :s => @product.unique_identifier, :f => 'p_id', :con => 'eq' )%>';
      });
    $("#btn_shipment_jump")
      .button()
      .click(function() {
        window.location = '<%=raw url_for(:action => :index, :controller => :shipments, :s => @product.unique_identifier, :f => 'p_id', :con => 'eq' )%>';
      });
    $( "#item_change_subscription_submit").button();
  });
<% end %>

<% content_for :action_bar do %>
<% if @product.can_edit?(current_user) && !@product.locked?%>
  <button id='btn_edit'>Edit</button>
  <button id='btn_adj_inventory'>Adjust Inventory</button>
<%end%>
<button id='btn_subscriptions'>Subscriptions<%=ItemChangeSubscription.count(:conditions => {:product_id => @product.id, :user_id => current_user.id}) == 0 ? '' : "*"%></button>
<button id='btn_order_jump'>Orders</button>
<button id='btn_shipment_jump'>Shipments</button>
<% end %>

<table>
<tr><td>
<!-- fields -->
	<table>
<tr class='hover'><td class='label_cell'>Unique identifier:</td><td><%= @product.unique_identifier %></td></tr>
<tr class='hover'><td class='label_cell'>Name:</td><td><%= @product.name %></td></tr>
<tr class='hover'><td class='label_cell'>Description:</td><td><%= @product.description %></td></tr>
<tr class='hover'><td class='label_cell'>Unit of Measure:</td><td><%= @product.unit_of_measure %></td></tr>
<tr class='hover'><td class='label_cell'>Vendor:</td><td><%= @product.vendor.name %> <%if(@product.vendor.locked?)%><span class='exception_value'>[LOCKED]</span><%end%></td></tr>
<tr class='hover'><td class='label_cell'>Division:</td><td><%= @product.division.name %></td></tr>
<tr class='hover'><td class='label_cell'>Inventory Quantity:</td><td><%=@product.current_inventory_qty%></td></tr>
<%=show_custom_fields @product, {:table=>true}%>
	</table>
</td><td>
<!-- image -->
<% 
	cd = CustomDefinition.where(:label => "PDM Number").first
	unless cd.nil?
		cv = @product.get_custom_value cd
		if ["K096SC03","K104SC75"].include?(cv.value)
%>
<a href='/images/polo/<%=cv.value%>.jpg' target='_blank'><%=image_tag("polo/#{cv.value}.jpg", "width" => "200px")%></a>
<%
		end
	end
%>
</td></tr>
</table>

<div id='mod_subscriptions' style='display:none;'>
  <% 
  change_subs = ItemChangeSubscription.where({:product_id => @product.id, :user_id => current_user.id})
  if change_subs.length == 0
   @ics = @product.item_change_subscriptions.build
   @ics.user = current_user 
  else
   @ics = change_subs[0]
  end 
 %>
 <%= form_for @ics, :html=>{:id=>'frm_sub'} do |ics| %>
    <%= ics.hidden_field :user_id %>
    <%= ics.hidden_field :product_id %>
    <%= ics.check_box :app_message %> Message<br />
    <%= ics.check_box :email %> Email<br />
 <% end %>
</div>
<div id='mod_inventory' style='display:none;'>
  <%form_tag('/adjust_inventory', :method=>"post", :id => "frm_inv") do %>
    <input type="hidden" name="product_id" value="<%=@product.id%>" />
  Current: <%=@product.current_inventory_qty%><br />
  New: <input type="text" name="quantity" /><br />
  <%end%>
</div>