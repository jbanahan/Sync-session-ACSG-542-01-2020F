<% content_for :javascript do %>
  $(function() {
  <% if @product.can_edit?(current_user) || @product.can_classify?(current_user)%>
    $( "#btn_edit" )
      .click(function() {
        window.location = '<%=edit_product_path(@product)%>';
      });
    $("#btn_classify").click(function() {
      var p = <%=@json_product.html_safe%>;
      Chain.showQuickClassify(p.product,"<%=product_path(@product)%>");  
    });
    OpenChain.addClickMap('e',"Edit","btn_edit");
    OpenChain.addClickMap('l',"Classify","btn_classify");
    OpenChain.activateHotKeys();
  <% end %>
  });
  <%unless current_user.hide_message?('prodlayout1')-%>
    $(document).ready(function() {
      $("#prodlayout1").modal()
      $("#never-show").click(function() {
        $("#prodlayout1").modal('hide');
        Chain.hideMessage('prodlayout1');
      });
      $("#show-tour").click(function() {
        $("#prodlayout1").modal('hide');
        bootstro.start('',{items:[
        {selector:'#prod_attr',content:'Product attributes are here. Empty fields are hidden.',placement:'right'},
        {selector:'#prod_class',content:'Product classifications, attachments, and comments are here.',placement:'left'}
        <% if (@product.can_edit?(current_user) || @product.can_classify?(current_user)) && !@product.locked? -%>
          ,{selector:'#btn_edit',content:'If you have permission, edit allows you to simultaneously modify attributes and classifications.'}
        <% end -%>
        ]});
      })
    });
  <%end-%>
<% end %>

<% content_for :action_bar do %>
  <% if (@product.can_edit?(current_user) || @product.can_classify?(current_user)) && !@product.locked?%>
    <button id='btn_edit'>Edit</button>
    <%if current_user.edit_classifications? %> <button id='btn_classify'>Classify</button><% end %>
  <%end%>
  <button class='btn_link' link_to='<%=products_path%>' key_map='b'>Back To Search</button>
  <%=render :partial => 'shared/show_next_prev', :locals => {:obj=>@product} %>
  <button class='btn_link' link_to='<%=history_product_path(@product)%>' key_map='h'>History</button>
<% end %>
<div class='container-fluid'>
  <div class='row-fluid'>
    <div class='span6' id='prod_attr'>
      <h3 class='text-center'>Attributes</h3>
      <%=render :partial => 'product_view', :locals => {:product => @product} %>
    </div>
    <div class='span6' id='prod_class'>
      <h3 class='text-center'>Classifications</h3>
      <% if !@product.saved_classifications_exist? && @product.can_classify?(current_user)-%>
        <div class='hero-unit'>
          <p>You don't have any classifications for this product.  Click the classify button to add some.</p>
        </div>
      <% else -%>
        <%=render :partial=>'show_classification'%>
      <%end-%>
      <%=render :partial => 'shared/attachments', :locals => {:attachable => @product} %>
      <%=render :partial => 'shared/comments', :locals => {:commentable => @product} %>
      <%if @product.on_bill_of_materials?-%>
        <div class='bom_cont'>
          <% unless @product.parent_products.empty? -%>
            <table class='detail_table'>
              <thead><tr><th>Parent Products</th></tr></thead>
              <tbody>
                <%@product.parent_products.each do |par| -%>
                  <tr><td><%=link_to par.unique_identifier, par%></td></tr>
                <%end-%>
              </tbody>
            </table>
          <% end -%>
          <% unless @product.bill_of_materials_children.empty? -%>
            <table class='detail_table'>
              <thead><tr><th>Child Products</th></tr></thead>
              <tbody>
                <%@product.bill_of_materials_children.each do |ch| -%>
                <tr><td><%=link_to ch.child_product.unique_identifier, ch.child_product%> - <span title='Total Pieces In Set'><%=ch.quantity%></span></td></tr>
                <%end-%>
              </tbody>
            </table>
          <% end -%>
        </div>
      <%end-%>
    </div>
  </div>
</div>
<%unless current_user.hide_message?('prodlayout1')-%>
  <div id='prodlayout1' class='modal hide fade'>
    <div class='modal-header'>
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>New Product Layout</h3>
    </div>
    <div class='modal-body'>
      <p>Welcome to the new product screens.</p>
      <ul>
        <li>The classification section is now on the right.</li>
        <li>Empty product attributes are hidden.</p>
        <%if @product.can_edit?(current_user) || @product.can_classify?(current_user)-%>
          <li>The advanced classification screen has been combined with the edit screen so you can edit product attributes and classifications at the same time. (If you have the appropriate permissions, of course.)</li>
        <%end-%>
      </ul>
      <p>Don't worry, all the stuff under the hood still works the same.</p>
    </div>
    <div class='modal-footer'>
      <button class='btn' id='never-show'>Never Show This Again</button>
      <button class='btn btn-primary' id='show-tour'>Give Me A Tour</button>
    </div>
  </div>
<%end-%>
