<%

newest_entry = nil
distribute_reads { newest_entry = @entries.order('updated_at DESC').first }
params[:page] ||= '1'
%>
<%-cache ['entries_by_release_range',newest_entry,params[:release_range],params[:page]] do-%>
  <%# do pagination here so it's inside the cache wrapper%>
  <div class="container">
    <div class="row">
      <div class="col-md-8 offset-md-2 text-center">
          <select id='rangeselect' class='form-control form-lg'>
            <%=options_for_select @range_descriptions%>
          </select>
      </div>
    </div>
  </div>
  <%# No clue why the following is needed, but the dependency isn't picked up if it's not there #%>
  <%# Template Dependency: entries/entry_list %>
  <%=render :partial=>'entry_list', locals:{entries:@entries}%>
  <%#- needs to be javascript so it executes inside of cache, can't use content_for -%>
<script type='text/javascript'> 
  $(document).ready(function() {
    $("#rangeselect").val('<%=params[:release_range]%>');
    $("#rangeselect").on('change',function() {
      base_url = '<%=request.original_fullpath.split("release_range").first%>';
      window.location = base_url+'release_range/'+$(this).val();
    });
  });
</script>
<%-end-%>
