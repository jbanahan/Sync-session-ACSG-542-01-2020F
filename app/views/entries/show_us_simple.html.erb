<%rule_state_field = ModelField.find_by_uid(:ent_rule_state)%>
<%content_for :action_bar do -%>
  <%pms = params.clone-%>
  <%pms[:mode]='detail'-%>
  <button title='Detail Mode' class='btn_link' link_to='<%=entry_path(@entry,pms)%>'><i class='fa fa-search-plus'></i></button>
  <%=business_rules_button rule_state_field, validation_results_entry_path(@entry)%>
  <%if current_user.company.master?-%>
    <%= link_to raw("<i class='fa fa-file-image-o'></i>"), get_images_entry_path(@entry), title:'Update Images', class: 'btn navbar-btn btn-default', form_class: 'inline-button-to inline-navbar-button', method: 'POST', style:'margin-right: -1px;'%>
  <%end-%>
<%end-%>
<style>
.ci_line td {
  border-top: 1px solid #333;
}
</style>
<%=render partial: '/shared/business_rules', locals:{base_object:@entry,rule_state_field:rule_state_field}%>
<a name='ent_header'></a>
<!-- Main header -->
<table class='ent_columns'>
  <tbody>
    <tr>
      <td style="width:33%;">
        <table>
          <%= show_model_fields @entry, [:ent_entry_num,:ent_brok_ref,:ent_customer_references,:ent_mbols,:ent_hbols,:ent_it_numbers,:ent_container_nums,:ent_export_date,:ent_isf_accepted_date,:ent_arrival_date,:ent_release_date], table: true %>
        </table>
      </td>
      <td style="width:33%;">
        <table>
          <%= show_model_fields @entry, :ent_entry_port_name, table: true, wrap_with: lambda {|mf, editor| !editor.blank? ? "<a href='/entries/importer/#{@entry.importer_id}/entry_port/#{@entry.entry_port_code}'>#{editor} <span class='glyphicon glyphicon-link' style='font-size:80%;'></span></a>".html_safe : ""} %>
          <%= show_model_fields @entry, [:ent_release_cert_message,:ent_cust_name,:ent_po_numbers,:ent_merch_desc,:ent_vessel,:ent_voyage,:ent_ult_con_name,:ent_transport_mode_code,:ent_carrier_code], table: true %>
        </table>
      </td>
      <td style="width:34%;">
        <table>
          <%= show_model_fields @entry, [:ent_total_fees,:ent_total_duty,:ent_entered_value,:ent_total_invoiced_value,:ent_total_units,:ent_total_units_uoms], table: true %>
        </table>
      </td>
    </tr>
  </tbody>
</table>
<%ci_line_count = @entry.commercial_invoice_lines.count  %>
<%if @entry.commercial_invoices.count >0%>
  <h1>Commercial Invoices</h1>
  <%ci_summary_fields = ModelField.viewable_model_fields(current_user, [:ci_invoice_number,:ci_vendor_name,:ci_invoice_value,:ci_gross_weight])%>
  <table class='detail_table'>
    <thead>
      <tr>
        <%= model_field_labels ci_summary_fields, table: true, heading: true  %>
      </tr>
    </thead>
    <tbody>
      <%@entry.commercial_invoices.each do |ci|%>
        <tr class='hover'>
          <%= show_model_fields ci, ci_summary_fields, table:true, editor_only: true %>
        </tr>
      <%end%>
    </tbody>
  </table>
  <hr />
<% end%>
<%=render :partial => 'shared/attachments', :locals => {:attachable => @entry, :width=>"wide"} %>
