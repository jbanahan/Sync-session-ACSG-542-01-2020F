<div id='chain-nav-panel' class="pb-3">
  <nav class='navbar navbar-dark pl-1 nav-small-screen topnav' role='navigation'>
    <button class="navbar-toggler" type="button" data-toggle="offcanvas" title="shortcut key: m">
      <span class="navbar-toggler-icon"></span>
    </button>
    <ul class="nav justify-content-end">
      <li class="nav-item">
        <a class="nav-link" href='/' title='Home'><i class="fa fa-home fa-lg" aria-hidden="true"></i></a>
      </li>
      <li id="user_mobile_dropdown_menu" class="nav-item dropdown">
        <div class="user-menu-loading">
          Please wait while the user menu is loading
        </div>
      </li>
      <li id='notification-center-wrapper' class="nav-item">
        <a class="nav-link pr-1" href="#" data-toggle='notification-center' title="shortcut key: n" onclick='return false;' class='message-envelope-wrapper'>
          <i class="fa fa-bell-o fa-lg message_envelope"></i>
        </a>
      </li>
    </ul>
    <ul class="nav">
      <li class="nav-item">
        <div class="input-group">
          <form class='form-inline pl-2' role='search' action='/quick_search' method='GET' id='mini-qs'>
            <div style="overflow: hidden: padding-right: 1em;">
              <input type='search' class='search-query form-control' placeholder='Quick Search' data-toggle='tooltip' title="shortcut key: /" name='v' aria-label="Search" style="width: 100%;">
            </div>
            <div class="input-group-append">
              <a href='javascript:void(null);' onclick="$('#mini-qs').submit(); return false;" role="button" class="pl-2">
                <i class='fa fa-search fa-lg'></i>
              </a>
            </div>
          </form>
        </div>
      </li>
    </ul>
  </nav>
  <nav class='navbar navbar-dark pl-1 nav-large-screen topnav' role='navigation'>
    <button id='btn-left-toggle' class="navbar-toggler" type="button" data-toggle="offcanvas" title="shortcut key: m">
      <span class="navbar-toggler-icon"></span>
    </button>
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <form class='form-inline pl-2' role='search' action='/quick_search' method='GET' id='quicksearch'>
          <input type='text' class='search-query form-control' placeholder='Quick Search' data-toggle='tooltip' title="shortcut key: /" name='v' id='quick_search_input' aria-label="Search">
          <a class="nav-link" href='#' onclick="$('#quicksearch').submit(); return false;" role="button">
            <i class='fa fa-search fa-lg pl-2'></i>
          </a>
        </form>
      </li>
    </ul>
    <ul class="nav justify-content-end">
    <%-unless current_user.hide_message?('vfitrack_tour')-%>
      <li class="nav-item">
        <button id='btn_nav_tour' class='btn btn-warning'>Take the Maersk Navigator Tour</button>
      </li>
    <%-end-%>
      <li class="nav-item">
        <a id="btn_home" class="nav-link" href='/' title='Home'><i class="fa fa-home fa-lg" aria-hidden="true"></i></a>
      </li>
      <li id="user_dropdown_menu" class="nav-item dropdown">
        <div class="user-menu-loading">
          <i class="fa fa-cog fa-spin fa-lg fa-fw"></i>
          <span class="sr-only">Loading...</span>
        </div>
      </li>
      <li id='notification-center-wrapper' class="nav-item">
        <a id="notification_bell" class="nav-link pr-1" href="#" data-toggle='notification-center' title="shortcut key: n" onclick='return false;' class='message-envelope-wrapper'>
          <i class="fa fa-bell-o fa-lg message_envelope"></i>
        </a>
      </li>
    </ul>
  </nav>
</div>
<div class="sidebar-offcanvas" id="sidebar">
  <div id='sidebar-loading'>
    <i class="fa fa-cog fa-spin fa-lg fa-fw"></i>
    <span class="sr-only">Loading...</span>
  </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="homepage-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h4 class="modal-title">Set Homepage To Current Page</h4></div>
      <div class="modal-body">
        <p>Click "OK" to make this page the first one you see when you log in to Maersk Navigator.</p>
        <p>You may also access your homepage at any time by clicking the Home link on the navigation bar.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="set-homepage-btn">OK</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="support-request-modal" tabindex="-1" role="dialog" aria-labelledby="requestSupportLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="requestSupportLabel">Request Support</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Send A Message:</p>
        <textarea class='form-control' id="support-request-body" autofocus=true rows=4></textarea>
        <br>
        <div class="alert alert-info col-12" id="request-alert" style="display:none;">
          Your request is being submitted.
        </div>
        <div class="alert alert-danger col-12" id="request-prompt" style="display:none;">
          You must enter a message first.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="submit-support-request-btn">OK</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="notification-center" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-max-width" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div id="messages-settings-menu" class="dropdown">
          <button type="button" class="btn btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-expanded="false">
            <span class='fa fa-cog'></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="messages-settings-menu">
            <a href="#" class='dropdown-item notification-mark-all-read'>Mark all read</a>
            <div class="dropdown-divider"></div>
            <a href="#" class='dropdown-item email-message-toggle'><span class='email-message-check-wrap'><%if current_user.email_new_messages%><span class='fa fa-check'></span><%end%></span> Email new messages</a>
          </div>
        </div>
        <div class="ml-auto">
          <div id="btn_messages_manuals" class="btn-group">
            <button type="button" class="btn btn-secondary" notification-center-toggle-target='messages'>Messages</button>
            <button type="button" class="btn btn-secondary" notification-center-toggle-target='manuals'>Manuals</button>
          </div>
        </div>
        <button type="button" class="close float-right" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id='notification-center-body'>
        <div notification-center-pane='messages' content-url='/messages'></div>
        <div notification-center-pane='manuals' content-url='/user_manuals/for_referer'></div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(function() {
    var userPromise = {
      then: function(callback) {
        callback(<%=scriptify_json(current_user.api_hash.to_json)%>);
      }
    };
    writeNotificationCenter = function(wrapper) {
      ChainNotificationCenter.initialize('<%=current_user.id%>', 30);
    }
    ChainNavPanel.write(userPromise,writeNotificationCenter);
  });
</script>
