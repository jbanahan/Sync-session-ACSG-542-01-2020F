<% if !local_assigns.has_key?(:view_only) || !view_only%>
  <% content_for :javascript do %>
    $(document).ready(function() {
      Chain.initAttachments();
    });    
  <% end %>
  <% if !attachable.respond_to?('can_attach?') || attachable.can_attach?(current_user)%>
    <% content_for :action_bar do %>
      <button id='btn_add_attachment'>Add Attachment</button>
    <%end%>
  <% end %>
<%end-%>
<% attachments = (attachable.respond_to?('all_attachments') ? attachable.all_attachments : attachable.attachments)-%>
<% unless attachments.blank?-%>
  <div class='row text-center'>
    <div class='col-md-12'>
      <h3>Attachments</h3>
    </div>
  </div>
  <div class='row'>
      <% attachments.each do |att| %>
        <div class='col-sm-6 col-md-4'>
          <div class='thumbnail text-center'>
            <div class='attachment_delete'>
              <%if attachable.can_edit?(current_user) && !att.attachable.is_a?(LinkableAttachment)%>
                <%=link_to(image_tag("x.png",:size=>"16x16"), att, :method => :delete, :confirm => "Are you sure you want to delete this?")%>
              <%else%>
                <%=image_tag('spacer.gif',:size=>'16x16')%>
              <%end%>
            </div>
            <%=attachment_icon att%>
            <div class='caption'>
              <%unless att.attachment_type.blank?%><h4><%=att.attachment_type%></h4><%end%>
              <p>
                <%=att.attached_file_name%>
              </p>
              <p>
                <%=link_to 'Download', download_attachment_path(att), :class=>'btn btn-primary btn-sm', :role=>'button', :target=>"chainio_attachment"%>
              </p>
            </div>
          </div>
        </div>
      <% end -%>
  </div>
<%end-%>
<div id='mod_attach' style='display:none;'>
  Attach File:<br />
  <% att = attachable.attachments.build %>
  <%=form_for att, :html=>{:multipart=>true,:id=>"frm_attach",:class=>'form-horizontal'} do |f|%>
    <%=f.hidden_field :attachable_id %>
    <%=f.hidden_field :attachable_type %>
    <%=f.collection_select :attachment_type, AttachmentType.all, :name, :name %>
    <%=f.file_field :attached %>
  <% end %>
</div>
