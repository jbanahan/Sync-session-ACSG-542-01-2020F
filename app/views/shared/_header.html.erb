<!DOCTYPE html>
<html>
<%
  no_buttons = false
  no_buttons = true if @no_buttons
  no_buttons = true if !local_assigns[:not_buttons].nil?
  show_navbar = (!no_buttons && current_user)
  ms = MasterSetup.get
-%>
  <head>
    <title><%= page_title(@page_title) %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <%= app_internals(ms) %>
    <%= favicon_links -%>

    <%= stylesheet_pack_tag "application", :media => "all" -%>
    <%= javascript_pack_tag "application", "components", "apps_every_page/chain_all_pages", "apps_every_page/nav_panel","apps_every_page/notification_center"-%>

    <% if @include_legacy_scripts %>
      <%= javascript_pack_tag "legacy" %>
    <% end %>
    <%= csrf_meta_tags %>
  <% if current_user&.sys_admin? %>
    <%= tag(:meta, {name: "server", content: "#{InstanceInformation.server_name}"})%>
  <% end %>
    <%= yield :head_tags -%>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <%= javascript_pack_tag "html5shim" %>
    <![endif]-->
    <script type='text/javascript'>
      <% if current_user %>
        $(document).ready(function() {
          <% if @state_button_path && @state_button_object_id %>
            ChainStateButtons.initialize('<%=@state_button_path%>',<%=@state_button_object_id%>);
          <% end %>
        });
        <% if @include_legacy_scripts %>
          OpenChain.user_id = <%=current_user.id%>;
        <% end %>
      <% end %>
      <%= yield :javascript -%>
    </script>
  </head>
  <% body_tag(ms, current_user, run_as_user) %>

    <% if show_navbar && current_user -%>
      <%= render "shared/nav_panel" %>
    <% end %>
    <%= render "shared/flash_notice" %>
    <div id='main-content' class="container-fluid">
      <%=yield%>
    </div>
    <%unless @no_action_bar-%>
      <div id="action_bar" class='navbar fixed-bottom'>
        <ul class='nav navbar-nav'>
          <li id='nav-action-bar'>
            <div class='btn-group'>
              <%=yield :action_bar%>
            </div>
          </li>
        </ul>
      </div>
    <%end-%>
    <%-if Rails.env.production?-%>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-43758898-1', 'vfitrack.net');
          ga('send', 'pageview');
      </script>
    <%-end-%>
    <%=yield :modal_container%>
  </body>
</html>
