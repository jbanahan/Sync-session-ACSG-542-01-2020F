<% content_for :javascript do %>
  $(function() {
    $("#btn_save").click(function() {$("#frm_user").submit();});
<%
cancel_redirect = "/"
cancel_redirect = company_users_path(@company) if current_user.admin?
%>
    $("#btn_cancel").click(function() {window.location = '<%=cancel_redirect%>'});
    $(".check_all").click(function(evt) {
      evt.preventDefault();
      $(this).parents('tr.permission_row').find(':checkbox').attr('checked','checked');
    });
    $("#mod_run_as").dialog({autoOpen:false,title:'Run As',
      width:'auto',
      buttons:{"OK":function() {$("#frm_run_as").submit();},
               "Cancel":function() {$("#mod_run_as").dialog('close');}}  
    });
    $("#btn_run_as").click(function() {
      <% if current_user == @user %>
      $("#mod_run_as").dialog('open');
      <% elsif current_user.admin? %>
      window.location = '/enable_run_as?username=<%=@user.username%>';
      <% end %>
    });
    $(".check_none").click(function(evt) {
      evt.preventDefault();
      $(this).parents('tr.permission_row').find(':checkbox').attr('checked','');
    });
    <% if @user.id -%>
      $("#btn_reports").click(function(evt) { window.location = "<%=user_scheduled_reports_path @user%>"});
    <% end -%>
  });
<%end%>
<%content_for :action_bar do %>
<button id='btn_save'>Save</button>
<button id='btn_cancel'>Cancel</button>
  <% if current_user.admin? %>
    <button id='btn_run_as'>Run As</button>
  <% end %>
  <% if @user.id -%>
    <button id="btn_reports">Reports</button>
  <% end -%>
<%end%>
<%= form_for([@company, @user], :html=>{:id=>'frm_user'}) do |f| %>
  <%= f.hidden_field :company_id %>
  <table>
  <%=field_row "Username", f.text_field(:username) %>
  <%=field_row "Email", f.text_field(:email) %>
  <%=field_row "First Name", f.text_field(:first_name)%>
  <%=field_row "Last Name", f.text_field(:last_name)%>
  <%=field_row "Password", f.password_field(:password, :title=>"Enter your new password into both password fields. If you don't need to change your password, you can leave this blank.") %>
  <%=field_row "Confirm Pasword", f.password_field(:password_confirmation, :title=>"Enter your new password into both password fields. If you don't need to change your password, you can leave this blank.") %>
  <%=field_row "Time Zone", f.time_zone_select(:time_zone, ActiveSupport::TimeZone.us_zones) %>
  <%=field_row "Email Format", f.select(:email_format,["html","text"])%>
  <% if current_user.admin? || current_user.view_official_tariffs? -%>
    <%=field_row "Email Me When Tariffs Are Updated", f.check_box(:tariff_subscribed)-%>
  <% end -%>
  <% if current_user.admin? %>
    <%=field_row "Account Locked", "<input type='checkbox' name='is_disabled' id='disabled' value='true' #{@user.disabled ? "checked='true'" : ""}/>".html_safe%>
    <%=field_row "Administrator", raw("<input type='checkbox' name='is_admin' id='admin' value='true' #{@user.admin ? "checked='true'" : ""}/>")%>
    <%=field_row "Support Agent", f.check_box(:support_agent)%>
    <% if current_user.sys_admin? %>
      <%=field_row "Sys Administrator", raw("<input type='checkbox' name='is_sys_admin' id='sys_admin' value='true' #{@user.sys_admin ? "checked='true'" : ""} />  (Aspect 9 Employees Only)")%>
      <%=field_row "Reset Password", raw("<input type='checkbox' name='password_reset' id='password_reset' value='true' #{@user.password_reset ? "checked='true'" : ""} />")%>
      <% if @user.debug_active? %>
        <%=field_row "Debug Will Expire", @user.debug_expires %>
      <% end %>
      <%=field_row "Set Debug Expiration", select_tag(:debug_expiration_hours,options_for_select([["Don't Change",""],["Now","0"],["1 hour","1"],["4 hours","4"],["8 hours","8"],["24 hours","24"]])) %>
      <%=field_row "VFI Track Homepage", f.text_field(:homepage) %>
    <% end %>
 <% end %>
  </table>

  <% if current_user.admin? %>
    <%=render :partial=>'permissions', :locals=>{:user=>@user,:f=>f} -%>
  <% end %>
<% end %>
<br />
<br />
<div id='mod_run_as' style='display:none;'>
  <div>Enter the username for the account you want to run as.</div>
  <form id='frm_run_as' method='GET' action='/enable_run_as'>
    <input type='text' name='username'>
  </form>
</div>
