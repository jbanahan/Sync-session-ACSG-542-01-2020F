<% content_for :javascript do %>
  $(function() {
    selected_user_ids = [];

    $( "#btn_new" )
      .click(function() {
        window.location = '<%=new_company_user_path(@company)%>';
        });
    $("#btn_bulk").click(function() {window.location = '<%=show_bulk_upload_company_users_path(@company)%>';});
    $("#btn_from_template").click(function() {window.location = '/companies/<%=@company.id%>/users/create_from_template';});
    $("#btn_send_email").click(function() {
      $("#users_form").submit();
    });

    $("#change_user_company_button").click(function(){
        $("#move_user_modal").modal('show');
    });

    $("#move_user_submit_button").click(function(){
      destination_company_id = parseInt($("#user_move_company_select").val());
      if (destination_company_id) { //this will catch null, undefined, NaN, 0, false, and empty strings
        $("#users_form :input:checkbox:checked").clone().appendTo("#hidden-ids")
        $("#move_users_form").submit();
      }
      else{
        alert("Please select a destination company for these users and then try again.");
      }
      
    });

  });
<% end %>
<% content_for :action_bar do -%>
  <% unless @company.locked? %>
    <% if !(@company.master? && MasterSetup.get.custom_feature?("WWW")) %>
      <button id='btn_new'>New</button>
    <% end %>
    <%if current_user.admin? -%>
      <button id='btn_from_template'>New From Template</button>
      <button id='btn_bulk'>Bulk</button>
      <button id="btn_send_email" title="Send a welcome email to selected users with their login and a new, random password.">Send Invite Email</button>
    <%end-%>
  <% end %>
  <% if current_user.sys_admin? -%>
    <button id="change_user_company_button" title="Move the selected user(s) from one company to another.">Move User(s)</button>
  <% end %>
<% end -%>
<h1><%=@company.name%> Users</h1>


<div>
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="nav-item">
      <a class="nav-link active" href="#active-users" aria-controls="active-users" role="tab" data-toggle="tab">Active Users</a>
    </li>
    <li role="presentation" class="nav-item">
      <a class="nav-link" href="#disabled-users" aria-controls="disabled-users" role="tab" data-toggle="tab">Disabled Users</a>
    </li>
  </ul>
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="active-users">
      <%=form_tag bulk_invite_company_users_path(@company), id: "users_form" do %>
        <%= render partial: 'users_form', locals: {users: @active_users} %>
      <% end %>
    </div>
    <div role="tabpanel" class="tab-pane" id="disabled-users">
      <%= render partial: 'users_form', locals: {users: @disabled_users} %>
    <div>
  </div>
</div>

<div class="modal fade" id="move_user_modal" tabindex=-1 role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Move User(s) to Another Company</h4>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body">
        <p>The selected user(s) should be transferred to...</p>
        <%=form_tag(move_to_new_company_users_path(), id: "move_users_form") do %>
          <select class="form-control" name="destination_company_id" id="user_move_company_select">
            <% Company.all.each do |c| %>
              <option value=<%=c.id%>>
                <%=c.name%>
              </option>
            <% end %>
          </select>
          <div id="hidden-ids" style="visibility: hidden;">
            Test
          </div>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="move_user_cancel_button" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="move_user_submit_button">Submit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
